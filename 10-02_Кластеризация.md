# Домашнее задание к занятию "`10.2 Кластеризация`" - `Юрий Чеканов`


---

### Задание 1
В чем различие между SMP и MPP системами?
*Приведите ответ в свободной форме.*

**SMP** (*symmetric multiprocessing*) – симметричная многопроцессорная архитектура. 
Главной особенностью систем с архитектурой SMP является наличие общей физической памяти, разделяемой всеми процессорами.
Память служит, в частности, для передачи сообщений между процессорами, при этом все вычислительные устройства при обращении к ней 
имеют равные права и одну и ту же адресацию для всех ячеек памяти. Поэтому SMP-архитектура называется симметричной. 
Последнее обстоятельство позволяет очень эффективно обмениваться данными с другими вычислительными устройствами. SMP-система строится 
на основе высокоскоростной системной шины (SGI PowerPath, Sun Gigaplane, DEC TurboLaser), к слотам которой подключаются функциональные 
блоки типов: процессоры (ЦП), подсистема ввода/вывода (I/O) и т. п. Для подсоединения к модулям I/O используются уже более медленные шины (PCI, VME64). 
Наиболее известными SMP-системами являются SMP-cерверы и рабочие станции на базе процессоров Intel (IBM, HP, Compaq, Dell, ALR, Unisys, DG, Fujitsu и др.) 
Вся система работает под управлением единой ОС (обычно UNIX-подобной, но для Intel-платформ поддерживается Windows NT). 
ОС автоматически (в процессе работы) распределяет процессы по процессорам, но иногда возможна и явная привязка.

**Основные преимущества SMP-систем:**
* простота и универсальность для программирования. Архитектура SMP не накладывает ограничений на модель программирования, 
используемую при создании приложения: обычно используется модель параллельных ветвей, когда все процессоры работают независимо друг от друга. 
Однако можно реализовать и модели, использующие межпроцессорный обмен. Использование общей памяти увеличивает скорость такого обмена, 
пользователь также имеет доступ сразу ко всему объему памяти. Для SMP-систем существуют довольно эффективные средства автоматического распараллеливания;
* простота эксплуатации. Как правило, SMP-системы используют систему кондиционирования, основанную на воздушном охлаждении, что облегчает их техническое обслуживание;
* относительно невысокая цена.

**Недостатки:**
* системы с общей памятью плохо масштабируются.

*Схематический вид SMP архитектуры:*
![Схема](/pics/1002/smp.png "Схематический вид SMP архитектуры")


**MPP** (*massive parallel processing*) – массивно-параллельная архитектура. Главная особенность такой архитектуры состоит в том, 
что память физически разделена. В этом случае система строится из отдельных модулей, содержащих процессор, локальный банк операционной памяти (ОП), 
коммуникационные процессоры (рутеры) или сетевые адаптеры, иногда – жесткие диски и/или другие устройства ввода/вывода. 
По сути, такие модули представляют собой полнофункциональные компьютеры (рисю25.3). Доступ к банку ОП из данного модуля имеют только процессоры (ЦП) 
из этого же модуля. Модули соединяются специальными коммуникационными каналами. Пользователь может определить логический номер процессора, 
к которому он подключен, и организовать обмен сообщениями с другими процессорами. Используются два варианта работы операционной системы (ОС) 
на машинах MPP-архитектуры. В одном полноценная операционная система (ОС) работает только на управляющей машине (front-end), на каждом отдельном модуле 
функционирует сильно урезанный вариант ОС, обеспечивающий работу только расположенной в нем ветви параллельного приложения. Во втором варианте на каждом 
модуле работает полноценная UNIX-подобная ОС, устанавливаемая отдельно.

Главным **преимуществом** систем с раздельной памятью является хорошая масштабируемость: в отличие от SMP-систем, в машинах с раздельной памятью 
каждый процессор имеет доступ только к своей локальной памяти, в связи с чем не возникает необходимости в потактовой синхронизации процессоров. 
Практически все рекорды по производительности на сегодня устанавливаются на машинах именно такой архитектуры, состоящих из нескольких тысяч 
процессоров (ASCI Red, ASCI Blue Pacific).

**Недостатки:**

* отсутствие общей памяти заметно снижает скорость межпроцессорного обмена, поскольку нет общей среды для хранения данных, предназначенных для 
обмена между процессорами. Требуется специальная техника программирования для реализации обмена сообщениями между процессорами;

* каждый процессор может использовать только ограниченный объем локального банка памяти;

* вследствие указанных архитектурных недостатков требуются значительные усилия для того, чтобы максимально использовать системные ресурсы. 
Именно этим определяется высокая цена программного обеспечения для массивно-параллельных систем с раздельной памятью.

*Схематический вид архитектуры с раздельной памятью:*
![Схема](/pics/1002/mpp.png "Схематический вид MPP архитектуры")


***Различия*** **SMP** ***и*** **MPP** ***систем следуют из их архитектуры.*** 
* Память - общая для SMP и физически разделена MPP архитектуры
* Единая ОС для SMP и отдельная ОС на каждом модуле в MPP
* Масштабируемость - ограничена для SMP и практически не ограничена для MPP
* Простота эксплуатации - легко для SMP и тяжело для MPP (одинаково справедливо для hardware и software) 
* Как следствие предыдущего утверждения стоимость эксплуатации MPP систем заметно выше. 


---

### Задание 2
В чем отличие сильно связанных и слабо связанных систем?
*Приведите ответ в свободной форме.*

***Слабосвязанная многопроцессорная система:***
Это тип многопроцессорной системы, в которой вместо общей памяти используется распределенная память. 
В слабосвязанной многопроцессорной системе скорость передачи данных ниже, чем в сильно связанной многопроцессорной системе. 
В слабосвязанной многопроцессорной системе модули соединяются через сеть MTS (Message Transfer System).

Слабосвязанная многопроцессорная система:
![Схема](/pics/1002/LCMS.jpg "Loosely coupled multiprocessor system")

***Тесно связанная многопроцессорная система:***
Это тип многопроцессорной системы, в которой есть общая память. 
В многопроцессорной системе с сильной связью скорость передачи данных выше, чем в многопроцессорной системе со слабой связью. 
В сильно связанной многопроцессорной системе модули соединяются через сети PMIN, IOPIN и ISIN.

Тесно связанная многопроцессорная система:
![Схема](/pics/1002/TCMS.jpg "Tightly coupled multiprocessor system")

***Ключевые различия между*** **слабосвязанной** ***и*** **тесно** ***связанной многопроцессорной системой:***
* Ключевое различие между слабосвязанной и тесно связанной системой состоит в том, что слабо связанная система имеет распределенную память, 
тогда как тесно связанная система имеет общую память.
* Слабосвязанное является эффективным, когда задачи, выполняемые на разных процессорах, имеют минимальное взаимодействие между ними. 
С другой стороны, тесно связанная система может обеспечивать более высокую степень взаимодействия между процессами и эффективна 
для высокоскоростной обработки в реальном времени.
* Слабосвязанная система, как правило, не сталкивается с конфликтом памяти, который чаще всего встречается в тесно связанной системе.
* Взаимосвязанной сетью в слабо связанной системе является система передачи сообщений (MTS), тогда как в тесно связанной системе межсоединительными 
сетями являются сеть межпроцессорного взаимодействия с памятью (PMIN), межсоединительная сеть ввода-вывода (IOPIN), соединительная сеть (ISIN).
* Скорость передачи данных в слабосвязанной системе низкая, тогда как скорость передачи данных в тесно связанной системе высокая.
* Слабосвязанная система дешевле, но больше по размеру, в то время как тесно связанная система дороже, но компактна по размеру.

---

### Задание 3
Какие преимущества отличают кластерные системы от обычных серверов?
*Приведите ответ в свободной форме.*

***Кластер — это разновидность параллельной или распределённой системы, которая:***

* Cостоит из нескольких связанных между собой компьютеров.
* Используется как единый, унифицированный компьютерный ресурс.

***Преимущества кластерных систем:***

* Большая надежность. При отказе компьютера, входящего в кластер, используются ресурсы прочих серверов из того же кластера.
* Высокая масштабируемость. В случае если нагрузка на кластер возрастет, в него просто добавляют еще один сервер.
* Возможность перераспределения ресурсов серверов. Можно сделать, для примера,  кластер для серверов приложений и другой кластер — для серверов БД. 
Далее, в случае, если нагрузка на сервер БД будет выше, чем предполагалось, то рассматривается вопрос о передаче одного сервера 
из первого кластера во второй или даже вопрос о совместном использовании одной или нескольких машин в двух кластерах.


---

### Задание 4
Приведите примеры типов современных кластерных систем?
*Приведите ответ в свободной форме.*

***Обычно различают следующие основные виды кластеров:***

* Отказоустойчивые кластеры (High-availability clusters (HA) - кластеры высокой доступности, 
Continuous Availability (CA) - кластеры непрерывной доступности, Fault Tolerant Cluster (FTC) - отказоустойчивые кластеры)
  * Пример: Corosync, Red Hat Cluster Suite, Microsoft Windows Server, Linux — HA, Pacemaker
* Кластеры с балансировкой нагрузки (Load balancing clusters)
  * сетевая балансировка (DNS-балансировка (Round Robin/Weighted Round Robin - алгоритм))
  * транспортная балансировка (Network Load Balancing - NLB cluster, BGP)
  * прикладная балансировка (Upstream модуль Nginx) 
* Вычислительные кластеры (High performance computing clusters, HPC)
* Системы распределенных вычислений (grid system, cluster system, + MPI-программы построеные по модели SPMD (одна программа - много данных))


---

### Задание 5
Где использует сервис Kafka, rabitMQ?
*Приведите ответ в свободной форме.*

**Kafka** — гибрид распределённой базы данных и брокера сообщений с возможностью горизонтального масштабирования. 
Kafka собирает у приложений данные, хранит их в своем распределённом хранилище, группируя по топикам, и отдаёт компонентам приложения по подписке. 
При этом сообщения хранятся на различных узлах-брокерах, что обеспечивает высокую доступность и отказоустойчивость.

**RabbitMQ** - программный брокер сообщений и распределенная система управления очередями. 

Данные сервисы **используются** на кластерах для обмена (в случае Kafka еще и храннения) данными между разными 
системами (передача данных в хранилище, потоковая аналитика, взаимодействие между сервисами и т. д.).

---

### Задание 6*
Исследуйте построение кластера на основе rabbitMQ https://github.com/ypereirareis/docker-rabbitmq-ha-cluster. 
Используя docker-compose соберите инфраструктуру. Исследуйте ее работы.

Ответьте на следующие вопросы:

- на каких компонетах развернут кластер?
  * кластер из трех серверов rabbitmq и балансировщик haproxy
- назначение компонентов кластера?
  * High-availability cluster (HA) - кластер высокой доступности 
- какие тесты можно провести для анализа работы кластера?
  * балансировка нагрузки
  * остановка/сбой одной или нескольких нод - отказоустойчивость
  * сетевой раздел 
  
  ![Screenshot](/pics/1002/rabbitmq.png "RabbitMQ")